<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <link href="http://gmpg.org/xfn/11" rel="profile">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>
    
      finleye &middot; Ruby on Rails Dev
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/styles.css">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/atom+xml" title="finleye" href="/atom.xml">
</head>


  <body>

    <div class="container content">
      <header class="masthead">
        <a href="/about">
          <img src="/assets/images/prof-pic-a.jpg" class="avatar" align="left" />
        </a>
        <h3 class="masthead-title">
          <a href="/" title="Home">finleye</a>
          <small>Ruby on Rails Dev</small>
        </h3>
      </header>

      <main>
        <div class="posts">
  
  <article class="post">
    <h1 class="post-title">
      <a href="/elixir/scheme/2016/01/16/other-languages.html">
        There's Always More to Learn
      </a>
    </h1>

    <time datetime="2016-01-16T09:00:00-05:00" class="post-date">16 Jan 2016</time>

    <p>I’ve been trying to broaden my skill set lately. I’m reading books that I should have long before now (<a href="http://www.amazon.com/Practical-Object-Oriented-Design-Ruby-Addison-Wesley/dp/0321721330">Practical Object-Oriented Design in Ruby</a>, and <a href="http://www.amazon.com/The-Pragmatic-Programmer-Journeyman-Master/dp/020161622X">The Pragmatic Programmer</a>), and I’m trying out a few languages. I wanted to play with functional programming because I have very little exposure to it, so on the suggestion of a co-worker, I started reading through <a href="http://www.amazon.com/The-Little-Schemer-4th-Edition/dp/0262560992">The Little Schemer</a>. It made me think about problems in a new way, and I think it improved my daily work.</p>

<h4 id="a-little-schemen">A little Scheme’n</h4>

<p>In a technical interview I was asked to write out, on a white board, how to implement <a href="http://apidock.com/ruby/Array/flatten">Ruby’s <code class="highlighter-rouge">flatten</code> method</a>. Flatten takes an Array and reduces it to a single dimension. I think this is a great exercise when trying out new languages, because you get to interact with objects, dissect them, and reconstruct them.</p>

<p><a href="http://www.amazon.com/The-Little-Schemer-4th-Edition/dp/0262560992">The Little Schemer</a> impresses that when working with functional languages you need to set out rules about how the iterations should work. Here’s the list for my algorithm:</p>

<ol>
  <li>Return when: all elements are <code class="highlighter-rouge">atom</code>s.</li>
  <li>Handle nulls: if the tail is null, then the only element is the head, flatten it!</li>
  <li>Else: merge the flattened head, and the flattened tail.</li>
</ol>

<p>First, let’s write a small test so that we know when it works.</p>

<figure class="highlight"><pre><code class="language-scheme" data-lang="scheme"><span class="c1">; sample lists</span>
<span class="p">(</span><span class="k">define</span> <span class="nv">l</span> <span class="o">'</span><span class="p">((</span><span class="nf">a</span><span class="p">)</span> <span class="nv">b</span><span class="p">)</span> <span class="p">)</span>
<span class="p">(</span><span class="k">define</span> <span class="nv">m</span> <span class="o">'</span><span class="p">(((</span><span class="nf">a</span><span class="p">))</span> <span class="p">(</span><span class="nf">b</span><span class="p">))</span> <span class="p">)</span>
<span class="p">(</span><span class="k">define</span> <span class="nv">n</span> <span class="o">'</span><span class="p">((</span><span class="nf">a</span> <span class="nv">b</span><span class="p">)</span> <span class="p">(</span><span class="nf">c</span> <span class="p">(</span><span class="nf">d</span> <span class="nv">e</span><span class="p">))))</span>

<span class="c1">; test flatten against all sample lists</span>
<span class="p">(</span><span class="k">define</span> <span class="nv">spec</span>
    <span class="p">(</span><span class="k">and</span>
        <span class="p">(</span><span class="nf">all_atoms?</span> <span class="p">(</span><span class="nf">flatten</span> <span class="nv">l</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">all_atoms?</span> <span class="p">(</span><span class="nf">flatten</span> <span class="nv">m</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">all_atoms?</span> <span class="p">(</span><span class="nf">flatten</span> <span class="nv">n</span><span class="p">))</span>
    <span class="p">)</span>
<span class="p">)</span></code></pre></figure>

<p>Run it:</p>

<figure class="highlight"><pre><code class="language-scheme" data-lang="scheme"><span class="nv">Error:</span> <span class="nv">execute:</span> <span class="nv">unbound</span> <span class="nv">symbol:</span> <span class="s">"flatten"</span> <span class="err">[]</span></code></pre></figure>

<p>Nice, let’s get started. Is the list <code class="highlighter-rouge">all_atoms?</code></p>

<figure class="highlight"><pre><code class="language-scheme" data-lang="scheme"><span class="p">(</span><span class="k">define</span> <span class="nv">atom?</span>
    <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span><span class="p">)</span>
        <span class="p">(</span><span class="k">and</span> <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nb">pair?</span> <span class="nv">x</span><span class="p">))</span> <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nb">null?</span> <span class="nv">x</span><span class="p">)))))</span>

<span class="p">(</span><span class="k">define</span> <span class="nv">all_atoms?</span>
    <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">li</span><span class="p">)</span>
        <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">null?</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">li</span><span class="p">))</span>
            <span class="p">(</span><span class="nf">atom?</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">li</span><span class="p">))</span>
            <span class="p">(</span><span class="k">and</span> <span class="p">(</span><span class="nf">atom?</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">li</span><span class="p">))</span> <span class="p">(</span><span class="nf">all_atoms?</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">li</span><span class="p">))))))</span></code></pre></figure>

<p>Eight lines, and forty two parenthesis later, we have a method that checks each element to see if it’s an <code class="highlighter-rouge">atom</code> only returning false if it’s not. We also have to merge the lists, so let’s write the <code class="highlighter-rouge">merge</code> method.</p>

<figure class="highlight"><pre><code class="language-scheme" data-lang="scheme"><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">merge</span> <span class="nv">l1</span> <span class="nv">l2</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">null?</span> <span class="nv">l1</span><span class="p">)</span> <span class="nv">l2</span>
        <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">null?</span> <span class="nv">l2</span><span class="p">)</span> <span class="nv">l1</span>
            <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">l1</span><span class="p">)</span> <span class="p">(</span><span class="nf">merge</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">l1</span><span class="p">)</span> <span class="nv">l2</span><span class="p">)))))</span></code></pre></figure>

<p>Also recursive, this method takes each element and adds it to the larger list.</p>

<p>Finally flatten them!</p>

<figure class="highlight"><pre><code class="language-scheme" data-lang="scheme"><span class="p">(</span><span class="k">define</span> <span class="nv">flatten</span>
    <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span><span class="p">)</span>
        <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">all_atoms?</span> <span class="nv">x</span><span class="p">)</span> <span class="nv">x</span>
            <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">null?</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">x</span><span class="p">))</span> <span class="p">(</span><span class="nf">flatten</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">x</span><span class="p">))</span>
                <span class="p">(</span><span class="nf">merge</span> <span class="p">(</span><span class="nf">flatten</span> <span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">x</span><span class="p">)))</span> <span class="p">(</span><span class="nf">flatten</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">x</span><span class="p">)))))))</span></code></pre></figure>

<p>Here we first check that the list is not all atoms, if it is, return it. If it has a list inside, continue. If the tail is null, then it’s just the head and it’s not an <code class="highlighter-rouge">atom</code> so flatten it. And finally if there is a head and a tail, merge the flattened version of the two.</p>

<p>Let’s run it and see if it works.</p>

<figure class="highlight"><pre><code class="language-scheme" data-lang="scheme"><span class="nv">:&gt;</span> <span class="nv">spec</span>
<span class="nv">=&gt;</span> <span class="no">#t</span></code></pre></figure>

<p>Boom! My obviously perfect test show how incredible my code is! Of course I’m kidding, but this looks like it is in fact working. You can take my word for it, or check out this <a href="https://repl.it/BQKT/12">repl.it</a> link to give it a shot. Now that it’s working, I want to try another language.</p>

<h4 id="elixir">Elixir</h4>

<p>Some people in my office have been talking about <a href="http://elixir-lang.org/">Elixir</a>, and I wanted to try it out, so I thought this was another perfect time to try to write flatten. I downloaded the language, and kicked up a new project with <code class="highlighter-rouge">mix</code>.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">mix new flatten</code></pre></figure>

<p>Let’s write some tests</p>

<figure class="highlight"><pre><code class="language-elixir" data-lang="elixir"><span class="c1"># test/flatten_test.exs</span>
<span class="k">defmodule</span> <span class="no">FlattenTest</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">ExUnit</span><span class="o">.</span><span class="no">Case</span>
  <span class="n">doctest</span> <span class="no">Flatten</span>

  <span class="n">test</span> <span class="sd">"</span><span class="s2">empty list"</span> <span class="k">do</span>
    <span class="n">assert</span> <span class="no">Flatten</span><span class="o">.</span><span class="n">flatten</span><span class="p">([])</span> <span class="o">==</span> <span class="p">[]</span>
  <span class="k">end</span>

  <span class="n">test</span> <span class="sd">"</span><span class="s2">list of atoms"</span> <span class="k">do</span>
    <span class="n">assert</span> <span class="no">Flatten</span><span class="o">.</span><span class="n">flatten</span><span class="p">([</span><span class="ss">:a</span><span class="p">,</span> <span class="ss">:b</span><span class="p">,</span> <span class="ss">:c</span><span class="p">])</span> <span class="o">==</span> <span class="p">[</span><span class="ss">:a</span><span class="p">,</span> <span class="ss">:b</span><span class="p">,</span> <span class="ss">:c</span><span class="p">]</span>
  <span class="k">end</span>

  <span class="n">test</span> <span class="sd">"</span><span class="s2">list of mixed data types"</span> <span class="k">do</span>
    <span class="n">assert</span> <span class="no">Flatten</span><span class="o">.</span><span class="n">flatten</span><span class="p">([</span><span class="ss">:a</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="ss">:c</span><span class="p">])</span> <span class="o">==</span> <span class="p">[</span><span class="ss">:a</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="ss">:c</span><span class="p">]</span>
  <span class="k">end</span>

  <span class="n">test</span> <span class="sd">"</span><span class="s2">flattens a list of an empty list"</span> <span class="k">do</span>
    <span class="n">assert</span> <span class="no">Flatten</span><span class="o">.</span><span class="n">flatten</span><span class="p">([[]])</span> <span class="o">==</span> <span class="p">[]</span>
  <span class="k">end</span>

  <span class="n">test</span> <span class="sd">"</span><span class="s2">flattens a list within a list"</span> <span class="k">do</span>
    <span class="n">assert</span> <span class="no">Flatten</span><span class="o">.</span><span class="n">flatten</span><span class="p">([</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="p">[</span><span class="m">3</span><span class="p">]])</span> <span class="o">==</span> <span class="p">[</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">]</span>
  <span class="k">end</span>

  <span class="n">test</span> <span class="sd">"</span><span class="s2">flattens a list within a list, when the head is a list"</span> <span class="k">do</span>
    <span class="n">assert</span> <span class="no">Flatten</span><span class="o">.</span><span class="n">flatten</span><span class="p">([[</span><span class="m">1</span><span class="p">],</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">])</span> <span class="o">==</span> <span class="p">[</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">]</span>
  <span class="k">end</span>

  <span class="n">test</span> <span class="sd">"</span><span class="s2">flattens a list within a list, when the head is a list in a list"</span> <span class="k">do</span>
    <span class="n">assert</span> <span class="no">Flatten</span><span class="o">.</span><span class="n">flatten</span><span class="p">([[[</span><span class="m">1</span><span class="p">]],</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">])</span> <span class="o">==</span> <span class="p">[</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">]</span>
  <span class="k">end</span>

  <span class="n">test</span> <span class="sd">"</span><span class="s2">flattens a list within a list, when the tail is a multipart list"</span> <span class="k">do</span>
    <span class="n">assert</span> <span class="no">Flatten</span><span class="o">.</span><span class="n">flatten</span><span class="p">([</span><span class="m">1</span><span class="p">,</span> <span class="p">[</span><span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">]])</span> <span class="o">==</span> <span class="p">[</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">]</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<p>Run it</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>mix <span class="nb">test
</span>8 tests, 8 failures</code></pre></figure>

<p>Cool! Got some tests. Let’s get started.</p>

<p>First, we need a handler method, we’ll just call it <code class="highlighter-rouge">flatten</code>, the first handler will just handle the empty array case.</p>

<figure class="highlight"><pre><code class="language-elixir" data-lang="elixir"><span class="k">def</span> <span class="n">flatten</span><span class="p">(</span><span class="n">input</span><span class="p">),</span> <span class="k">do</span><span class="p">:</span> <span class="n">_flatten</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
<span class="k">defp</span> <span class="n">_flatten</span><span class="p">([]),</span> <span class="k">do</span><span class="p">:</span> <span class="p">[]</span></code></pre></figure>

<p>Now if we run the test again, we should at least get the first one to pass.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>mix <span class="nb">test
</span>8 tests, 7 failures</code></pre></figure>

<p>Nice. One down and only seven to go. Now there are two cases for the iteration. The head is a list, in which case we should concatenate the flattened head with the flattened tail.</p>

<figure class="highlight"><pre><code class="language-elixir" data-lang="elixir"><span class="k">defp</span> <span class="n">_flatten</span><span class="p">([</span><span class="n">head</span><span class="o">|</span><span class="n">tail</span><span class="p">])</span> <span class="ow">when</span> <span class="n">is_list</span><span class="p">(</span><span class="n">head</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">_flatten</span><span class="p">(</span><span class="n">head</span><span class="p">)</span> <span class="o">++</span> <span class="n">_flatten</span><span class="p">(</span><span class="n">tail</span><span class="p">)</span>
<span class="k">end</span></code></pre></figure>

<p>That gets us down to just six failures, so let’s handle the other case. If the head is not a list, we should concatenate the head in a list, with the flattened version of the tail. That looks like this;</p>

<figure class="highlight"><pre><code class="language-elixir" data-lang="elixir"><span class="k">defp</span> <span class="n">_flatten</span><span class="p">([</span><span class="n">head</span><span class="o">|</span><span class="n">tail</span><span class="p">]),</span> <span class="k">do</span><span class="p">:</span> <span class="p">[</span><span class="n">head</span><span class="p">]</span> <span class="o">++</span> <span class="n">_flatten</span><span class="p">(</span><span class="n">tail</span><span class="p">)</span></code></pre></figure>

<p>You can see the <a href="https://github.com/finleye/flatten/blob/master/lib/flatten.ex">full Flatten module here</a>. Let’s try it!</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>mix <span class="nb">test
</span>8 tests, 0 failures</code></pre></figure>

<p>Nice! All green! As you can see I’ve barely scratched the surface of what this language is capable of, but at least I’ve figured out some of the syntax and how the language works. If you want to see the full <code class="highlighter-rouge">mix</code> project, it’s <a href="https://github.com/finleye/flatten">here in a repo</a>.</p>

<h4 id="onward-and-upward">Onward and upward</h4>

<p>I really liked working with these other languages, and plan to spend more time with them. I don’t often use recursion as a strategy for solving problems in my daily work, it rarely calls for it. But these exercises make me think about programming challenges in a different way, and that’s always a good thing.</p>

<p>I’m still working on my next post about my Sinatra project. But I’ll have it posted shortly. As always, feel free to contact me on <a href="https://twitter.com/cfinley">twitter</a> or <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#102;&#105;&#110;&#108;&#101;&#121;&#046;&#099;&#111;&#114;&#101;&#121;&#064;&#103;&#109;&#097;&#105;&#108;&#046;&#099;&#111;&#109;">email</a> me. See you soon! See you soon!</p>


  </article>
  
  <article class="post">
    <h1 class="post-title">
      <a href="/instagram/sandbox/2016/01/15/sandbox-mode.html">
        Head in the Sandbox
      </a>
    </h1>

    <time datetime="2016-01-15T09:00:00-05:00" class="post-date">15 Jan 2016</time>

    <p>I spent way to much time banging my head against my keyboard when I was getting empty responses from Instagram’s API, and hopefully I can help some of you avoid doing the same. I’ll quickly outline some of Instagram’s sandbox API limitations and what to expect.</p>

<h4 id="but-this-call-works">But this call works?</h4>

<p>In my <a href="/sinatra/instagram/2016/01/14/instagram-integration.html">previous post</a> I talked about setting up Instagram API integration in a [Sinatra][insatra] app. And I quickly hit a wall. I was able to get the <code class="highlighter-rouge">#user_recent_media</code> call working no issue. I signed in as myself and was able to see my recent posts. So I moved on to my main goal, which was searching the API by location. I added some coordinates for Manhattan and got <em>nothing</em>…</p>

<p>Here’s how it went</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">insta_client</span> <span class="o">=</span> <span class="no">Instagram</span><span class="p">.</span><span class="nf">client</span><span class="p">(</span><span class="ss">access_token: </span><span class="n">some_token</span><span class="p">)</span></code></pre></figure>

<p>Great. I have a client.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">insta_client</span><span class="p">.</span><span class="nf">user_recent_media</span><span class="p">.</span><span class="nf">media</span>
<span class="o">=&gt;</span> <span class="p">[</span><span class="o">&lt;</span><span class="no">Media</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="no">Media</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="no">Media</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">.</span><span class="nf">.</span><span class="o">.</span><span class="p">]</span></code></pre></figure>

<p>Great! Plenty of pictures!</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">insta_client</span><span class="p">.</span><span class="nf">media_search</span><span class="p">(</span><span class="s1">'40.7127'</span><span class="p">,</span> <span class="s1">'74.0059'</span><span class="p">,</span> <span class="ss">distance: </span><span class="mi">5000</span><span class="p">).</span><span class="nf">media</span>
<span class="o">=&gt;</span> <span class="p">[]</span></code></pre></figure>

<p>Nothing…</p>

<p>I looked at the call. I was getting a 200. No problems with the authentication. No network issues.</p>

<p>I spent some time searching the web and found the smoking gun. It was <em><a href="https://www.instagram.com/developer/sandbox/">sandbox mode</a></em>!</p>

<h4 id="maybe-read-the-api-docs">Maybe read the API Docs</h4>

<p>As it turns out, in November of 2015, Instagram changed their API so that all new apps start in sandbox mode when using the API, until they are approved. This limits your interactions with the API in a few ways, but the problem here was that I wanted public data (scope key <code class="highlighter-rouge">public_data</code>), but in sandbox mode “public” means public data from your applications users. So, you only get public data from users who have been invited to test your app, and authorized the app for <code class="highlighter-rouge">public_data</code>.</p>

<p>After searching for coordinates for an area I had tagged images for, I was able to get images.</p>

<p>Then after looking at the docs for sandbox mode, I found this;</p>

<blockquote>
  <p>The response returned by this endpoint will contain only media with the given tag, as expected. But instead of returning media from any public Instagram user, it will return only media that belongs to your sandbox users, restricted to the last 20 for each user.</p>
</blockquote>

<p>In the end, <a href="https://en.wikipedia.org/wiki/RTFM">RTFM</a>.</p>

<p>Up next, adding a couple rails conveniences to Sinatra. Until then, feel free to contact me on <a href="https://twitter.com/cfinley">twitter</a> or <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#102;&#105;&#110;&#108;&#101;&#121;&#046;&#099;&#111;&#114;&#101;&#121;&#064;&#103;&#109;&#097;&#105;&#108;&#046;&#099;&#111;&#109;">email</a> me. See you soon!</p>


  </article>
  
  <article class="post">
    <h1 class="post-title">
      <a href="/sinatra/instagram/2016/01/14/instagram-integration.html">
        Instagram Integration
      </a>
    </h1>

    <time datetime="2016-01-14T09:00:00-05:00" class="post-date">14 Jan 2016</time>

    <p>Adding Instagram API integration to your application is pretty straight forward, but some parts can be tricky. I’ll walk through what I did, and hopefully make it an easy task if you decide to try it.</p>

<h4 id="adding-the-instagram-api-gem">Adding the Instagram API gem</h4>
<p>I’m using the <a href="https://github.com/Instagram/instagram-ruby-gem">Instagram API gem</a> for <a href="https://github.com/finleye/still-leaf">this project</a>. To add this gem to your <a href="http://www.sinatrarb.com/">Sinatra</a> app, you’ll just need to do the following;</p>

<p>Add the gem to your app’s <code class="highlighter-rouge">Gemfile</code></p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">gem</span> <span class="s2">"instagram"</span></code></pre></figure>

<p>And run <code class="highlighter-rouge">bundle</code> from the command line to install the gem.</p>

<p>I added an initializer to set up them gem:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1">#/config/initializers/instagram.rb</span>
<span class="no">Instagram</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">client_id</span> <span class="o">=</span> <span class="no">ENV</span><span class="p">[</span><span class="s2">"INSTAGRAM_CLIENT_ID"</span><span class="p">]</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">client_secret</span> <span class="o">=</span> <span class="no">ENV</span><span class="p">[</span><span class="s2">"INSTAGRAM_CLIENT_SECRET"</span><span class="p">]</span>
<span class="k">end</span></code></pre></figure>

<p>Then add this to your application’s <code class="highlighter-rouge">config.ru</code></p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">'instagram'</span></code></pre></figure>

<p>Now that the Instagram gem is set up, we’ll use it in the application file.</p>

<h4 id="oauth-endpoints">OAUTH Endpoints</h4>
<p>Your application will need to know how to handle the handshake with Instagram’s API. You’ll need a few endpoints to handle this.</p>

<p>The first endpoint will send the request for the authentication token.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">get</span> <span class="s1">'/oauth/connect'</span> <span class="k">do</span>
  <span class="n">scope</span> <span class="o">=</span>  <span class="s1">'likes public_content'</span>
  <span class="n">redirect</span> <span class="no">Instagram</span><span class="p">.</span><span class="nf">authorize_url</span><span class="p">(</span><span class="ss">redirect_uri: </span><span class="no">ENV</span><span class="p">[</span><span class="s1">'INSTAGRAM_CALLBACK_URL'</span><span class="p">],</span> <span class="ss">scope: </span><span class="n">scope</span><span class="p">)</span>
<span class="k">end</span></code></pre></figure>

<p>The <code class="highlighter-rouge">scope</code> part of this block tells their API what all you want access to. In this case I want the ability to like photos, and access to public content. Note that you’ll be providing a redirect URL as well. This tells Instagram where you send back the <code class="highlighter-rouge">access_token</code>.</p>

<p>In the callback endpoint, you’ll need to save the <code class="highlighter-rouge">access_token</code>, and then send them on their way with something to show.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">get</span> <span class="s1">'/oauth/callback'</span> <span class="k">do</span>
  <span class="n">response</span> <span class="o">=</span> <span class="no">Instagram</span><span class="p">.</span><span class="nf">get_access_token</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:code</span><span class="p">],</span> <span class="ss">redirect_uri: </span><span class="no">ENV</span><span class="p">[</span><span class="s1">'INSTAGRAM_CALLBACK_URL'</span><span class="p">])</span>
  <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="nf">access_token</span>
    <span class="n">session</span><span class="p">[</span><span class="ss">:ig_access_token</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="nf">access_token</span>
    <span class="n">flash</span><span class="p">[</span><span class="ss">:success</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"You've logged in as @</span><span class="si">#{</span><span class="n">insta_client</span><span class="p">.</span><span class="nf">user</span><span class="p">.</span><span class="nf">username</span><span class="si">}</span><span class="s2">."</span>
  <span class="k">else</span>
    <span class="n">flash</span><span class="p">[</span><span class="ss">:alert</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Something went wrong."</span>
  <span class="k">end</span>

  <span class="n">redirect</span> <span class="s1">'/user_recent_media'</span>
<span class="k">end</span></code></pre></figure>

<p>One thing to note here is that <code class="highlighter-rouge">ig_access_token</code> is being added to the <code class="highlighter-rouge">session</code>. This is a given in Rails, but here you’ll need to enable sessions for Sinatra. Below you’ll class declaration, add <code class="highlighter-rouge">enable :sessions</code>. Mine looks like this:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">StillLeaf</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">enable</span> <span class="ss">:sessions</span></code></pre></figure>

<h4 id="show-the-user-something-from-instagram">Show the user something from Instagram</h4>
<p>You may have noticed in my OAUTH callback endpoint, that I redirect to <code class="highlighter-rouge">/user_recent_media</code>. This action renders a view of the current users recent media from Instagram. That code looks like this:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">get</span> <span class="s1">'/user_recent_media'</span> <span class="k">do</span>
  <span class="vi">@user</span> <span class="o">=</span> <span class="n">insta_client</span><span class="p">.</span><span class="nf">user</span>
  <span class="vi">@recent_media</span> <span class="o">=</span> <span class="n">insta_client</span><span class="p">.</span><span class="nf">user_recent_media</span>

  <span class="n">haml</span> <span class="ss">:user_media</span>
<span class="k">end</span></code></pre></figure>

<p>You’ll see references to a method called <code class="highlighter-rouge">insta_client</code>, references a memoization of the client so it can be reused. The <code class="highlighter-rouge">insta_client</code> method looks like this:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">insta_client</span>
  <span class="vi">@insta_client</span> <span class="o">=</span> <span class="no">Instagram</span><span class="p">.</span><span class="nf">client</span><span class="p">(</span><span class="ss">access_token: </span><span class="n">session</span><span class="p">[</span><span class="ss">:ig_access_token</span><span class="p">])</span>
<span class="k">end</span></code></pre></figure>

<p>If you want to see how <code class="highlighter-rouge">@user</code> and <code class="highlighter-rouge">@recent_meda</code> are being used, take a look at <a href="https://github.com/finleye/still-leaf/blob/master/views/user_media.haml">the view in the repo</a>, and the full application class can be found <a href="https://github.com/finleye/still-leaf/blob/master/still_leaf.rb">here in the repo</a> as well.</p>

<p>That covers everything to get the <code class="highlighter-rouge">access_token</code> from Instagram, and use the client to get media. My next post will be about Instagram’s API sandbox mode and it’s limitations. Until then, feel free to contact me on <a href="https://twitter.com/cfinley">twitter</a> or <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#102;&#105;&#110;&#108;&#101;&#121;&#046;&#099;&#111;&#114;&#101;&#121;&#064;&#103;&#109;&#097;&#105;&#108;&#046;&#099;&#111;&#109;">email</a> me. See you soon!</p>


  </article>
  
  <article class="post">
    <h1 class="post-title">
      <a href="/sinatra/instagram/2016/01/13/day-1.html">
        Day 1
      </a>
    </h1>

    <time datetime="2016-01-13T09:00:00-05:00" class="post-date">13 Jan 2016</time>

    <p>So you want to build a Sinatra app using Instagram’s API? Well you’re in luck! I’ll go though some of what I did, and hopefully provide some insight.</p>

<h4 id="getting-started">Getting started</h4>

<p>An easy solution for boiler-plating an app is to use <a href="https://github.com/zachpendleton/snfn">Snfn</a>. Similar to <code class="highlighter-rouge">rails new commandsapp</code>, you can run <code class="highlighter-rouge">snfn my_app</code> to get something going. It throws together an application class, and gives you some minimal setup with a views folder and importantly a <code class="highlighter-rouge">config.ru</code>, for use with <code class="highlighter-rouge">rackup</code>.</p>

<p>That <code class="highlighter-rouge">config.ru</code> file contains some information about how your app should be loaded and ran. You can take a look at the <code class="highlighter-rouge">config.ru</code> file for <a href="https://github.com/finleye/still-leaf">Still Leaf</a>, here <a href="https://github.com/finleye/still-leaf/blob/master/config.ru">in the repo</a>. In mine you’ll see some load path stuff, bundler, and so on. What’s really important here is the last line:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">run</span> <span class="no">StillLeaf</span></code></pre></figure>

<p>This actually kicks up the application and gives you something to look at. One confusing bit in the beginning that caused me issue was this:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="sx">%w{config/initializers lib}</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">load_path</span><span class="o">|</span>
  <span class="no">Find</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">load_path</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>
    <span class="nb">require</span> <span class="n">f</span> <span class="k">unless</span> <span class="n">f</span><span class="p">.</span><span class="nf">match</span><span class="p">(</span><span class="sr">/\/\..+$/</span><span class="p">)</span> <span class="o">||</span> <span class="no">File</span><span class="p">.</span><span class="nf">directory?</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
  <span class="p">}</span>
<span class="k">end</span></code></pre></figure>

<p>The problem here being the <code class="highlighter-rouge">config/initializers</code>, the first element in the array. While this bit of code is provided by <a href="https://github.com/zachpendleton/snfn">Snfn</a>, there is no <code class="highlighter-rouge">config/initializers</code> directory provided. From the app directory just run this to clear up this issue.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>mkdir config
<span class="gp">$ </span><span class="nb">cd </span>config/
<span class="gp">$ </span>mkdir initializers</code></pre></figure>

<p>Then when you run <code class="highlighter-rouge">rackup</code>, it won’t blow up trying to load nonexistent directories.</p>

<h4 id="how-to-handle-env-variables">How to handle ENV variables</h4>
<p>I knew I would be hosting this on <a href="https://www.heroku.com/">Heroku</a>, because it’s easy, free (at first), and well, mostly because I don’t know how to set up something on AWS. That’ll come in a much later post when I embark on that part of the journey.</p>

<p>I like to use a gem called <a href="https://github.com/bkeepers/dotenv">dotenv</a>, I’ve used it before and it works well enough for what I need. You set up a <code class="highlighter-rouge">.env</code> in the root of the app, and it interacts in the application, the same way Heroku environment variables do.</p>

<p>Here’s a <code class="highlighter-rouge">.env</code> setup walkthrough;</p>

<p>First, add it to your <code class="highlighter-rouge">Gemfile</code></p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Gemfile</span>
<span class="n">group</span> <span class="ss">:test</span><span class="p">,</span> <span class="ss">:development</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">'dotenv-rails'</span>
<span class="k">end</span></code></pre></figure>

<p>Then add it to your <code class="highlighter-rouge">.gitignore</code>.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>touch .env
<span class="gp">$ </span><span class="nb">echo</span> .env &gt;&gt; .gitignore</code></pre></figure>

<p>Then your <code class="highlighter-rouge">.env</code> will look like this;</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">INSTAGRAM_CLIENT_ID</span><span class="o">=</span>your_client_id
<span class="nv">INSTAGRAM_CLIENT_SECRET</span><span class="o">=</span>your_client_secret
<span class="nv">INSTAGRAM_CALLBACK_URL</span><span class="o">=</span>http://localhost:9292/oauth/callback
<span class="nv">GOOGLE_MAPS_GEOCODING_KEY</span><span class="o">=</span>your_gmaps_geocodding_key</code></pre></figure>

<p>You’ll need to add it to your <code class="highlighter-rouge">config.ru</code> so the app knows how to load it;</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># config.ru</span>
<span class="k">if</span> <span class="no">ENV</span><span class="p">[</span><span class="s1">'RACK_ENV'</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">'production'</span>
  <span class="nb">require</span> <span class="s1">'dotenv'</span>
  <span class="no">Dotenv</span><span class="p">.</span><span class="nf">load</span>
<span class="k">end</span></code></pre></figure>

<p>Then you can do something like this in the app to use your environment variables.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">ENV</span><span class="p">[</span><span class="s2">"INSTAGRAM_CLIENT_ID"</span><span class="p">]</span></code></pre></figure>

<p>Boom! Secure environment variables for running the app locally. Up next: I’ll walk though some of the set up the <a href="https://www.instagram.com/developer/">Instagram API</a> and the pains of <a href="https://www.instagram.com/developer/sandbox/">sandbox mode</a>.</p>


  </article>
  
  <article class="post">
    <h1 class="post-title">
      <a href="/sinatra/heroku/instagram/2016/01/12/what-to-call-it.html">
        What to call it
      </a>
    </h1>

    <time datetime="2016-01-12T09:21:19-05:00" class="post-date">12 Jan 2016</time>

    <p>A while back, a co-worker of mine, <a href="https://github.com/briancantrell">Brian</a>, told me about an idea for an app that would use the <a href="https://www.instagram.com/developer/">Instagram API</a>. I wanted to help and decided to write a small <a href="http://www.sinatrarb.com/">Sinatra</a> app to play with the API. A lot of frustration and learning later I figured out a few things;</p>

<ol>
  <li>Much of my Ruby knowledge turned out to be Rails knowledge. Small stuff, for example <code class="highlighter-rouge">#present?</code> is part of Rails, not Ruby.</li>
  <li>It’s tricky to build a Sinatra app and stick to its framework. I had to read up on Sinatra conventions in an attempt to not build of all the Rails <em>conveniences</em> (read crutches) that I counted on.</li>
  <li><a href="https://www.instagram.com/developer/sandbox/">Instagram’s Sandbox</a> mode for their API will make you pull your hair out if you don’t understand it.</li>
</ol>

<h3 id="it-needs-a-better-name">It needs a (better) name</h3>
<p>But first, I had to figure out what to call it. I know you shouldn’t name things first, but I had to at least figure out what to call the repo. I started with <strong>Instalocation</strong>. Terrible, I know, but it was a location search of the API, so it seemed practical. I decided the best bet was to try a random app name generator. I landed on <strong>Still Leaf</strong> and went with it.</p>

<p>My next post will be about some of the gems I used, and some things I learned about <a href="http://www.sinatrarb.com/">Sinatra</a>.</p>

<p>See you soon!</p>


  </article>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/blog/page2/">Older</a>
  
  
    <span class="pagination-item newer">Newer</span>
  
</div>

      </main>

      <footer class="footer">
  <div>
    <a href="/about">About me</a>
    <a href="https://github.com/finleye"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">finleye</span></a>

    <a href="https://twitter.com/cfinley"><span class="icon icon--twitter"><svg viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">cfinley</span></a>

  </div>
  <small>
    &copy; <time datetime="2016-01-18T18:58:55-05:00">2016</time>. All rights reserved.
  </small>
  <small>
    <a href="/disclaimer">Disclaimer</a>
  </small>
</footer>

      <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-42037834-2', 'auto');
  ga('send', 'pageview');

</script>

    </div>
  </body>
</html>
